<!DOCTYPE html>
<!-- Copyright 2020, Brigham Young University - Idaho. All rights reserved. -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CSE 111 - Prepare</title>
    <link rel="icon" type="image/png" href="../site/icon.png">
    <link rel="stylesheet" type="text/css" href="../site/style.css">
    <link rel="stylesheet" type="text/css" href="../site/hljs/vscode.css">
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-database.js"></script>
    <script src="../site/url.js"></script>
    <script src="../site/urlWrite.js"></script>
    <script src="../site/color.js"></script>
    <script src="../site/linenums.js"></script>
    <script src="../site/hljs/highlight.pack.js"></script>
</head>

<body>
<header>
    <div class="colorCtrl">&nbsp;</div>
    <div class="logo">
        <div class="upper">BYU</div>
        <div class="lower">Idaho</div>
    </div>
    <h2>CSE 111 | <span>Programming with Functions</span></h2>
</header>
<article>
    <h1>05 Prepare: Testing Functions</h1>
    <p>During this lesson, you will learn to use a more systematic
    approach to developing code. Specifically, you will learn how to
    write test functions that automatically verify that other functions
    are correct. You will learn how to use a Python module named
    <code>pytest</code> to run your test functions, and you will learn
    how to read the output of <code>pytest</code> to help you find and
    fix mistakes in your code.</p>

    <h2>Concepts</h2>
    <p>Here are the Python programming concepts and topics that you
    should learn during this lesson:</p>
    <ol class="long">
        <li><div>During previous lessons, you tested your programs by
        running them, typing user input, reading the output, and
        verifying that the output was correct. This is a valid way to
        test a program. However, it is time consuming, tedious, and
        error prone. A much better way to test a program is to test its
        functions individually and to write test functions that
        <em>automatically</em> verify that the program's functions are
        correct.</div></li>

        <li><div><a href="https://docs.pytest.org/en/latest/reference.html"><code>pytest</code></a>
        is a Python module that makes it easy to write and run test
        functions. There are other Python testing modules besides
        <code>pytest</code>, but <code>pytest</code> seems to be the
        easiest. <code>pytest</code> is not a standard Python module. It
        is a third-party module. This means that when you installed
        Python on your computer, <code>pytest</code> was not installed,
        and you will need to install pytest in order to use it.</div></li>

        <li><div><code>pytest</code> allows us to write simple test
        functions that use the built-in Python
        <a href="https://docs.python.org/3/reference/simple_stmts.html#the-assert-statement"><code>assert</code></a>
        statement to verify that a function returns a correct result.
        For example, if we want to verify that the built-in
        <code>min</code> function works correctly, we could write an
        <code>assert</code> statement like this:
<div class="pre"><pre class="python">assert min(7, -3, 0, 2) == -3</pre></div>
        The previous line of code will cause the computer to first call
        the <code>min</code> function and pass 7, -3, 0, and 2 as
        arguments to the <code>min</code> function. The <code>min</code>
        function will find the minimum value of its parameters and
        return that minimum value. Then the <code>assert</code>
        statement will compare the returned minimum value to -3. If the
        returned minimum value is not -3, the <code>assert</code>
        statement will raise an exception which will cause
        <code>pytest</code> to print an error message.</div></li>

        <li><div><p>Within a computer's memory, everything (all numbers,
        text, sound, pictures, movies, everything) is stored using the
        binary number system. When executing Python code, a computer
        stores integers in binary in a way that exactly represents the
        integers. For example, a computer executing Python code stores
        the integer 23 as 00010111 in binary which is an exact
        representation of decimal 23. However, when executing Python
        code, a computer approximates floating point numbers (numbers
        with digits after the decimal place). For example, a computer
        stores the floating point number 23.7 as
        1000001101111011001100110011010 in binary. This binary number is
        actually 23.700000762939453 in decimal which is an approximation
        to 23.7.</p>

        <p>Because computers approximate floating point numbers, we must
        be careful when comparing floating point numbers in our test
        functions. It is bad practice to check if floating point numbers
        are equal using just the equality operator (==).
        The <code>pytest</code> module contains a function named
        <a href="https://docs.pytest.org/en/latest/reference.html#pytest-approx"><code>approx</code></a>
        to help us compare floating point numbers. For example, to test
        the <code>math.sqrt</code> function, we could write an
        <code>assert</code> statement like this:</p>
<div class="pre"><pre class="python">assert math.sqrt(5) == approx(2.24, 0.01)</pre></div>
        <p>The previous <code>assert</code> statement verifies that the
        value returned from <code>math.sqrt(5)</code> is within 1%
        (0.01) of 2.24.</p>
        </div></li>

        <li><div>In this course, you will write your test functions in a
        Python file that is separate from your Python program. In other
        words, you will keep normal program code and test code in
        separate files.</div></li>

        <li><div>To test a function you should do the following:
        <ol class="long">
            <li><div>Write a function that is part of your normal Python
            program.</div></li>
            <li><div>Think about different parameter values that will
            cause the computer to execute all the code in your function
            and will possibly cause your function to fail or return an
            incorrect result.</div></li>
            <li><div>In a separate Python file, write a test function
            that calls your program function and uses an
            <code>assert</code> statement to <em>automatically</em>
            verify that the value returned from your program function is
            correct.</div></li>
            <li><div>Use <code>pytest</code> to run the test
            function.</div></li>
            <li><div>Read the output of <code>pytest</code> and use that
            output to help you find and fix mistakes in both your
            program function and test function.</div></li>
        </ol></div></li>

        <li><div><a href="https://docs.python.org/3/installing/index.html"><code>pip</code></a>
        is a standard Python module that you can use to download and
        install third-party modules. During the checkpoint of this
        lesson, you will use <code>pip</code> to download and install
        <code>pytest</code>, so that you can use <code>pytest</code> in
        your test code.</div></li>
    </ol>

    <h2 id="example">Example</h2>
    <p>Here is a simple function named <code>cels_from_fahr</code> that
    converts a temperature in Fahrenheit to Celsius and returns the
    Celsius temperature. The <code>cels_from_fahr</code> function is
    part of a larger Python program in a file named
    <code>weather.py</code>:</p>

<div class="pre"><pre class="linenums"></pre>
<pre class="python" id="ex1"># weather.py

def cels_from_fahr(fahr):
    """Convert a temperature in Fahrenheit to
    Celsius and return the Celsius temperature.
    """
    cels = (fahr - 32) * 5 / 9
    return cels</pre></div>

    <p>We want to test the <code>cels_from_fahr</code> function. From
    the function header at
    <span class="cross" data-ref="ex1">line&nbsp;3</span> in
    <code>weather.py</code>, we see that <code>cels_from_fahr</code>
    takes one parameter named <var>fahr</var>. To adequately test this
    function, we should call it with at least the following:&nbsp; a
    negative number, zero, and a positive number, so we write a test
    function in a separate file named <code>test_weather.py</code>:</p>

<div class="pre"><pre class="linenums"></pre>
<pre class="python" id="ex2"># test_weather.py

from weather import cels_from_fahr
from pytest import approx
import pytest

def test_cels_from_fahr():
    """Test the cels_from_fahr function by calling it and comparing
    the values it returns to the expected values. Notice this test
    function uses pytest.approx to compare floating point numbers.
    """
    assert cels_from_fahr(-25) == approx(-31.76667)
    assert cels_from_fahr(0) == approx(-17.77778)
    assert cels_from_fahr(32) == approx(0)
    assert cels_from_fahr(70) == approx(21.1111)

# Call the main function that is part of pytest so that
# the test functions in this file will start executing.
pytest.main(["-v", "--tb=no", "test_weather.py"])</pre></div>

    <p>Notice in <code>test_weather.py</code> at
    <span class="cross" data-ref="ex2">lines&nbsp;12&ndash;15</span>
    that the test function
    <code>test_cels_from_fahr</code>
    calls the program function <code>cels_from_fahr</code> four
    times:&nbsp; once with a negative number, once with zero, and twice
    with positive numbers. Notice also that the test function uses
    <code>assert</code> and <code>approx</code>.</p>

    <p>After writing the test function, we use <code>pytest</code> to
    run the test function. At
    <span class="cross" data-ref="ex2">line&nbsp;19</span>,
    instead of writing a call to the <code>main</code> function as we do
    in program files, we write a call to <code>pytest.main</code>. In
    CSE&nbsp;111, in all test files, we will write a call to
    <code>pytest.main</code>
    to cause <code>pytest</code> to run the test functions. When
    <code>pytest</code> runs the test functions, it will produce output
    that tells us if the tests passed or failed like this:</p>

<pre class="console">&gt; python test_weather.py
========================= test session starts =========================
platform win32 -- Python 3.8.5, pytest-6.1.1, py-1.9.0, pluggy-0.13.1
rootdir: C:\Users\cse111\lesson05
collected 1 item

test_weather.py::test_cels_from_fahr <span class="pass">PASSED                      [100%]</span>

<span class="pass">========================== 1 passed in 0.10s ==========================</span></pre>

    <p>As shown above, <code>pytest</code> runs the
    <code>test_cels_from_fahr</code> function which calls the
    <code>cels_from_fahr</code> function four times and verifies that
    <code>cels_from_fahr</code> returns the correct value each time. We
    can see from the output of <code>pytest</code>, "[100%] and 1
    passed", that the <code>cels_from_fahr</code> function returned the
    expected (correct) result all four times.</p>

    <h2 id="separate">Separating Program Code from Test Code</h2>
    <p>As explained above, in CSE&nbsp;111, we will write test functions
    in a different file than program functions. It is a good idea to
    separate test functions and program functions. This separation makes
    it easy to release a program to users without releasing the test
    functions to them. (In general, users of a program don't want the
    test functions.) One consequence of writing program functions and
    test functions in separate files is that we must add an import
    statement at the top of the test file that imports all the program
    functions that will be tested.</p>

    <p>Line&nbsp;3 from <code>test_weather.py</code> above is an example
    of an import statement that imports functions from a program file.
    Line&nbsp;3 matches this template:</p>

<div class="pre"><pre class="python">from <var>file_name</var> import <var>function_1</var>, <var>function_2</var>, &hellip; <var>function_N</var></pre></div>

    <p>When the computer imports functions from a file, the computer
    immediately executes all statements that are not written in a
    function. This includes the statement to call the <code>main</code>
    function:</p>

<div class="pre"><pre class="python">
# Start this program by
# calling the main function.
main()</pre></div>

    <p>This means that when we run our test functions, the computer will
    import our program functions and at the same time, execute the call
    to <code>main()</code> which will start the program executing.
    However, we don't want the computer to execute the program while it
    is executing the test functions, so we have a problem. How can we
    get the computer to import the program functions without executing
    the <code>main</code> function? Fortunately, the developers of
    Python gave us a solution to this problem. Instead of writing the
    following code to start our program running:</p>

<div class="pre"><pre class="python">
# Start this program by
# calling the main function.
main()</pre></div>

    <p>We write an <code>if</code> statement above the call to
    <code>main()</code> like this:</p>

<div class="pre"><pre class="python">
# If this file is executed like this:
# &gt; python program.py
# then call the main function. However, if this file is simply
# imported (e.g. into a test file), then skip the call to main.
if __name__ == "__main__":
    main()</pre></div>

    <p>Writing the <code>if</code> statment above the call to
    <code>main()</code> is the correct way to write code to start our
    program. The Python programming language guarantees that when the
    computer imports the program functions (in order to test them), the
    comparison in the <code>if</code> statement will be false, so the
    computer will skip the call to <code>main()</code>. At another time,
    when the computer executes the program (not the test functions), the
    comparison in the <code>if</code> statement will be true, which will
    cause the computer to call the <code>main</code> function and start
    the program.</p>

    <h2>Documentation</h2>
    <p>The official online documentation for <code>pytest</code>
    contains much more information about using <code>pytest</code>. The
    following pages are the most applicable to CSE&nbsp;111:</p>

    <ul class="links">
        <li><div><a href="https://docs.pytest.org/en/latest/getting-started.html#create-your-first-test">Create your first test</a></div></li>
        <li><div><a href="https://docs.pytest.org/en/latest/assert.html#asserting-with-the-assert-statement"><code>assert</code></a></div></li>
        <li><div><a href="https://docs.pytest.org/en/latest/reference.html#pytest-approx"><code>pytest.approx</code></a></div></li>
        <li><div><a href="https://docs.pytest.org/en/latest/usage.html#calling-pytest-from-python-code"><code>pytest.main</code></a></div></li>
        <li><div>Assert that an <a href="https://docs.pytest.org/en/latest/getting-started.html#assert-that-a-certain-exception-is-raised">exception is raised</a> (taught in the next lesson)</div></li>
    </ul>
</article>
<footer>
    <small>Copyright &copy; 2020, Brigham Young University - Idaho. All
    rights reserved.</small>
</footer>
</body>
</html>
